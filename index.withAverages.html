(
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Obesity in The United States</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="bootstrap.min.css">
  <script src="jquery.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <link rel="stylesheet" href="stylesheet.css" />
  <script src="d3.v4.min.js"></script>
  <script src="d3-scale-chromatic.v1.min.js"></script>
  <script src="plotly-latest.min.js"></script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

</head>

<body>

  <div class="jumbotron text-center" style="height:200px;">
    <h1>Obesity in the US</h1>
    <p>An Interactive Web App</p>
  </div>

  <div class="container" width=100%>
    <div class="row">
      <div class="col-lg-6" id="map1">
        <script>

          //document.getElementById("buttonID").onclick =updateMap();




          var width = 864;
          var height = 450;

          var drop1map1Val = 0
          var drop2map1Val = 0
          var drop3map1Val = 0

          // D3 Projection
          var projection = d3.geoAlbersUsa()
            .translate([width / 2, height / 2])    // translate to center of screen
            .scale([900]);          // scale things down so see entire US

          // Define path generator
          var path = d3.geoPath()               // path generator that will convert GeoJSON to SVG paths
            .projection(projection);  // tell path generator to use albersUsa projection
          var svg = d3.select("body")
            .append("svg")
            .attr("width", "50%")
            .attr("height", height);



          //this whole part should be a function that takes two .csv names or column names
          //depending on which method we go with and develop two maps depending on those
          //variables. I could make it work now, but all it would be doing is copy/pasting
          //the next 60 lines which wouldnt be helpful to anyone.

          // Append Div for tooltip to SVG
          var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

          // Load in my states data!
          var statesArray = Array(51)
          var yearsArray = ["2011", "2012", "2013", "2014", "2015"]
          var classArray = ["Age", "Education", "Gender", "Income", "Race"]
          var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
          var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
          var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
          var gender = ["Female", "Male"]
          var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
          var subArray = [ages, education, gender, income, races]

          d3.csv("MapData.csv", function (data) {
            //color.domain([0, 1, 2, 3]); // setting the range of the input data

            // this will need to be adjusted to add all of the data from the csv ***
            // Load GeoJSON data and merge with states data
            d3.json("us-states.json", function (json) {
              // Loop through each state data value in the .csv file
              var maxRate = 0;
              var minRate = 100;
              for (var p = 0; p < json.features.length; p++) { //state loop
                statesArray[p] = Array(5)
                for (var t = 0; t < 5; t++) { //loop for each year
                  var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
                  var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
                  var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
                  var gender = ["Female", "Male"]
                  var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
                  statesArray[p][t] = [ages, education, gender, income, races]
                }

                json.features[p].properties.year = statesArray[p]
              }

              for (var k = 0; k < json.features.length; k++) {
              }
              for (var i = 0; i < data.length; i++) {

                // Grab State Name/class/subclass/year
                var dataValue = data[i].Value;
                var dataState = data[i].LocationDesc;
                var dataClass = data[i].Class;
                var dataSub = data[i].Subclass;
                var datayear = data[i].YearStart
                var yearIndex = -1
                var classIndex = -1
                var subIndex = -1

                // Grab data value

                if (dataValue > maxRate && dataValue != "DNE") {
                  maxRate = dataValue
                }

                if (dataValue < minRate && dataValue != "DNE") {
                  minRate = dataValue
                }
                // Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {

                  var jsonState = json.features[j].properties.name;

                  if (dataState == jsonState) {
                    //these switches give the indices where to store the data values within the bigArrays 
                    switch (datayear) {
                      case "2011":
                        yearIndex = 0
                        break;
                      case "2012":
                        yearIndex = 1
                        break;
                      case "2013":
                        yearIndex = 2
                        break;
                      case "2014":
                        yearIndex = 3
                        break;
                      case "2015":
                        yearIndex = 4
                        break;
                      default:
                        break;
                    }

                    switch (dataClass) {
                      case "Age":
                        classIndex = 0
                        switch (dataSub) {
                          case "18 - 24":
                            subIndex = 0
                            break;
                          case "25 - 34":
                            subIndex = 1
                            break;
                          case "35 - 44":
                            subIndex = 2
                            break;
                          case "45 - 54":
                            subIndex = 3
                            break;
                          case "55 - 64":
                            subIndex = 4
                            break;
                          case "65 or older":
                            subIndex = 5
                            break;
                          default:
                            break;

                        }
                        break;
                      case "Education":
                        classIndex = 1
                        switch (data[i].Subclass) {
                          case "College graduate":
                            subIndex = 0
                            break;
                          case "High school graduate":
                            subIndex = 1
                            break;
                          case "Less than high school":
                            subIndex = 2
                            break;
                          case "Some college or technical school":
                            subIndex = 3
                            break;
                          default:
                            break;
                        }
                        break;
                      case "Gender":
                        classIndex = 2
                        switch (data[i].Subclass) {
                          case "Female":
                            subIndex = 0
                            break;
                          case "Male":
                            subIndex = 1
                            break;
                          default:
                            break;
                        }
                        break;
                      case "Income":
                        classIndex = 3
                        switch (data[i].Subclass) {
                          case "Less than $15,000":
                            subIndex = 0
                            break;
                          case "$15,000 - $24,999":
                            subIndex = 1
                            break;
                          case "$25,000 - $34,999":
                            subIndex = 2
                            break;
                          case "$35,000 - $49,999":
                            subIndex = 3
                            break;
                          case "$50,000 - $74,999":
                            subIndex = 4
                            break;
                          case "$75,000 or greater":
                            subIndex = 5
                            break;
                          case "Data not reported":
                            subIndex = 6
                          default:
                            break;
                        }
                        break;
                      case "Race/Ethnicity":
                        classIndex = 4
                        switch (data[i].Subclass) {
                          case "American Indian/Alaska Native":
                            subIndex = 0
                            break;
                          case "Non-Hispanic Black":
                            subIndex = 1
                            break;
                          case "Non-Hispanic White":
                            subIndex = 2
                            break;
                          case "Asian":
                            subIndex = 3
                            break;
                          case "Hawaiian/Pacific Islander":
                            subIndex = 4
                            break;
                          case "Hispanic":
                            subIndex = 5
                            break;
                          case "2 or more races":
                            subIndex = 6
                          case "Other":
                            subIndex = 7
                            break;
                          default:
                            break;
                        }
                        break;
                      default:
                        break;
                    }
                    if (dataValue != "DNE" && yearIndex >= 0 && classIndex >= 0 && subIndex >= 0) {

                      json.features[j].properties.year[yearIndex][classIndex][subIndex] = parseFloat(dataValue)
                    } else {
                      json.features[j].properties.year[yearIndex][classIndex][subIndex] = dataValue
                    }
                  }


                  // Stop looking through the JSON
                }
              }
              console.log("out of loop")


              //TODO: currently does not show totals, need to import ObesityTotalByStateAndYear.csv and use that data properly
              //to show totals data. Should we allow users to look at totals? it would require another button without a doubt.
              drawTotalsMap1()
              // Bind the data to the SVG and create one path per GeoJSON feature
              function drawTotalsMap1() {
                svg.selectAll("path")
                  .data(json.features)
                  .enter()
                  .append("path")
                  .attr("d", path)
                  .style("stroke", "#fff")
                  .style("stroke-width", "1")
                  .style("fill", function (d) {

                    // Get data value
                    var value = d.properties.year[0][0][0];

                    if (value === "DNE") {
                      //If value exists…
                      //If value is und efined…
                      return "rgb(255,201,132)";


                    } else {
                      if (value > 40) {
                        color = d3.interpolateBlues(1)
                      } else {
                        color = d3.interpolateBlues(value / 45)
                      }
                      //var color = d3.scaleLinear().domain([0, 60]).range(["white", "steelblue"])
                      return color//(value);
                    }
                  })
                svg.selectAll("path")
                  // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
                  // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                  .on("mouseover", function (d) {
                    div.transition()
                      .duration(200)
                      .style("opacity", .9);
                    div.text(d.properties.name + ": " + d.properties.year[0][0][0] + "%")
                      .style("left", (d3.event.pageX) + "px")
                      .style("top", (d3.event.pageY - 28) + "px");
                  })

                  // fade out tooltip on mouse out               
                  .on("mouseout", function (d) {
                    div.transition()
                      .duration(500)
                      .style("opacity", 0);
                  });
                var avg = 0
                var sum = 0
                for (var a = 0; a < json.features.length; a++) {
                  sum = json.features[a].properties.year[drop1map1Val][drop2map1Val][drop3map1Val] + sum
                }
                avg = sum / 51
                d3.select("#avg1")
                  .remove()

                d3.select("#map1")
                  .append("div")
                  .attr("id", "avg1")
                  .attr("ALIGN", "center")
                  .attr("style", "font-size:20px;color:black")
                  .text("Average Obesity PCT: " + avg.toFixed(1) + "%")
              }
            });
          });



          //making the years dropdown box
          var dropdowns = d3.select("#map1")
            .append("div")
            .attr("class", "dropdown")
            .attr("id", "drop1map1");

          var button = d3.select("#drop1map1")
            .append("button")
            .attr("class", "btn btn-primary dropdown-toggle")
            .attr("type", "button")
            .attr("data-toggle", "dropdown")
            .text("Select Year")
            .attr("id", "drop1buttonmap1");

          var span = d3.select("#drop1buttonmap1")
            .append("span")
            .attr("class", "caret")

          var menu = d3.select("#drop1map1")
            .append("ul")
            .attr("class", "dropdown-menu")
            .attr("id", "drop1listmap1");

          for (var k = 0; k < yearsArray.length; k++) {
            var dropSubs = d3.select("#drop1listmap1")
              .append("li")
              .attr("id", "drop1limap1")

            var addSubs = d3.select("#drop1limap1")
              .append("a")
              .text(yearsArray[k])
              .attr("onclick", "setDrop1map1(" + k + ");changedrop1map1(" + k + ")")
          }
          function changedrop1map1(j) {
            $("#drop1buttonmap1")
              .remove()

            var button = d3.select("#drop1map1")
              .append("button")
              .attr("class", "btn btn-primary dropdown-toggle")
              .attr("type", "button")
              .attr("data-toggle", "dropdown")
              .text(yearsArray[j])
              .attr("id", "drop1buttonmap1");
            var span = d3.select("#drop1buttonmap1")
              .append("span")
              .attr("class", "caret")
          };

          function setDrop1map1(data) {
            drop1map1Val = data
            updateMap1()

          }
          //making the class dropdown boxes

          var dropdowns = d3.select("#map1")
            .append("div")
            .attr("class", "dropdown")
            .attr("id", "drop2map1");

          var button = d3.select("#drop2map1")
            .append("button")
            .attr("class", "btn btn-primary dropdown-toggle")
            .attr("type", "button")
            .attr("data-toggle", "dropdown")
            .text("Select Class")
            .attr("id", "drop2buttonmap1");

          var span = d3.select("#drop2buttonmap1")
            .append("span")
            .attr("class", "caret")

          var menu = d3.select("#drop2map1")
            .append("ul")
            .attr("class", "dropdown-menu")
            .attr("id", "drop2listmap1");

          for (var j = 0; j < classArray.length; j++) {
            var dropSubs = d3.select("#drop2listmap1")
              .append("li")
              .attr("id", "drop2limap1")

            var addSubs = d3.select("#drop2limap1")
              .append("a")
              .text(classArray[j])
              .attr("onclick", "makeDrop3map1(" + j + ");setDrop2map1(" + j + ");changedrop2map1(" + j + ")")


          }

          function changedrop2map1(j) {
            $("#drop2buttonmap1")
              .remove()

            var button = d3.select("#drop2map1")
              .append("button")
              .attr("class", "btn btn-primary dropdown-toggle")
              .attr("type", "button")
              .attr("data-toggle", "dropdown")
              .text(classArray[j])
              .attr("id", "drop2buttonmap1");
            var span = d3.select("#drop2buttonmap1")
              .append("span")
              .attr("class", "caret")
          };

          function setDrop2map1(data) {
            drop2map1Val = data
          };


          var dropdowns = d3.select("#map1")
            .append("div")
            .attr("class", "dropdown")
            .attr("id", "drop3map1");

          var button = d3.select("#drop3map1")
            .append("button")
            .attr("class", "btn btn-primary dropdown-toggle")
            .attr("type", "button")
            .attr("data-toggle", "dropdown")
            .text("Select Subclass")
            .attr("id", "drop3buttonmap1");

          var span = d3.select("#drop3buttonmap1")
            .append("span")
            .attr("class", "caret")

          var menu = d3.select("#drop3map1")
            .append("ul")
            .attr("class", "dropdown-menu")
            .attr("id", "drop3listmap1");

          function makeDrop3map1(subclassVal) {
            d3.selectAll("#drop3limap1").remove()
            var dropSubs = d3.select("#drop3listmap1")
              .append("li")
              .attr("id", "drop3limap1")

            for (var k = 0; k < subArray[subclassVal].length; k++) {

              var addSubs = d3.select("#drop3limap1")
                .append("a")
                .text(subArray[subclassVal][k])
                .attr("onclick", "setDrop3Map1(" + k + ");changedrop3map1(" + k + "," + subclassVal + ")")

            }
            //making the third subclass array which is variable based on a variable

          }

          function changedrop3map1(j, subClassVal) {
            $("#drop3buttonmap1")
              .remove()

            var button = d3.select("#drop3map1")
              .append("button")
              .attr("class", "btn btn-primary dropdown-toggle")
              .attr("type", "button")
              .attr("data-toggle", "dropdown")
              .text(subArray[subClassVal][j])
              .attr("id", "drop3buttonmap1");
            var span = d3.select("#drop3buttonmap1")
              .append("span")
              .attr("class", "caret")
          };

          function setDrop3Map1(val) {
            drop3map1Val = val;
            updateMap1();
          }

          function updateMap1() {
            makemap1(drop1map1Val, drop2map1Val, drop3map1Val);

          }



          // var buildMap1 = d3.select("#map1")
          //   .append("button")
          //   .attr("class", "button")
          //   .attr("onclick", "makemap1(" + drop1map1Val + "," + drop2map1Val + "," + drop3map1Val + ")")
          //   .text("Click to build map")


          function makemap1(y, c, s) {
            var statesArray = Array(51)
            var yearsArray = ["2011", "2012", "2013", "2014", "2015"]
            var classArray = ["Age", "Education", "Gender", "Income", "Race"]
            var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
            var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
            var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
            var gender = ["Female", "Male"]
            var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
            d3.csv("MapData.csv", function (data) {
              //color.domain([0, 1, 2, 3]); // setting the range of the input data

              // this will need to be adjusted to add all of the data from the csv ***
              // Load GeoJSON data and merge with states data
              d3.json("us-states.json", function (json) {
                // Loop through each state data value in the .csv file
                var maxRate = 0;
                var minRate = 100;
                for (var p = 0; p < json.features.length; p++) { //state loop
                  statesArray[p] = Array(5)
                  for (var t = 0; t < 5; t++) { //loop for each year
                    var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
                    var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
                    var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
                    var gender = ["Female", "Male"]
                    var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
                    statesArray[p][t] = [ages, education, gender, income, races]
                  }

                  json.features[p].properties.year = statesArray[p]
                }

                for (var k = 0; k < json.features.length; k++) {
                }
                for (var i = 0; i < data.length; i++) {

                  // Grab State Name/class/subclass/year
                  var dataValue = data[i].Value;
                  var dataState = data[i].LocationDesc;
                  var dataClass = data[i].Class;
                  var dataSub = data[i].Subclass;
                  var datayear = data[i].YearStart
                  var yearIndex = -1
                  var classIndex = -1
                  var subIndex = -1

                  // Grab data value

                  if (dataValue > maxRate && dataValue != "DNE") {
                    maxRate = dataValue
                  }

                  if (dataValue < minRate && dataValue != "DNE") {
                    minRate = dataValue
                  }
                  // Find the corresponding state inside the GeoJSON
                  for (var j = 0; j < json.features.length; j++) {

                    var jsonState = json.features[j].properties.name;

                    if (dataState == jsonState) {
                      //these switches give the indices where to store the data values within the bigArrays 
                      switch (datayear) {
                        case "2011":
                          yearIndex = 0
                          break;
                        case "2012":
                          yearIndex = 1
                          break;
                        case "2013":
                          yearIndex = 2
                          break;
                        case "2014":
                          yearIndex = 3
                          break;
                        case "2015":
                          yearIndex = 4
                          break;
                        default:
                          break;
                      }

                      switch (dataClass) {
                        case "Age":
                          classIndex = 0
                          switch (dataSub) {
                            case "18 - 24":
                              subIndex = 0
                              break;
                            case "25 - 34":
                              subIndex = 1
                              break;
                            case "35 - 44":
                              subIndex = 2
                              break;
                            case "45 - 54":
                              subIndex = 3
                              break;
                            case "55 - 64":
                              subIndex = 4
                              break;
                            case "65 or older":
                              subIndex = 5
                              break;
                            default:
                              break;

                          }
                          break;
                        case "Education":
                          classIndex = 1
                          switch (data[i].Subclass) {
                            case "College graduate":
                              subIndex = 0
                              break;
                            case "High school graduate":
                              subIndex = 1
                              break;
                            case "Less than high school":
                              subIndex = 2
                              break;
                            case "Some college or technical school":
                              subIndex = 3
                              break;
                            default:
                              break;
                          }
                          break;
                        case "Gender":
                          classIndex = 2
                          switch (data[i].Subclass) {
                            case "Female":
                              subIndex = 0
                              break;
                            case "Male":
                              subIndex = 1
                              break;
                            default:
                              break;
                          }
                          break;
                        case "Income":
                          classIndex = 3
                          switch (data[i].Subclass) {
                            case "Less than $15,000":
                              subIndex = 0
                              break;
                            case "$15,000 - $24,999":
                              subIndex = 1
                              break;
                            case "$25,000 - $34,999":
                              subIndex = 2
                              break;
                            case "$35,000 - $49,999":
                              subIndex = 3
                              break;
                            case "$50,000 - $74,999":
                              subIndex = 4
                              break;
                            case "$75,000 or greater":
                              subIndex = 5
                              break;
                            case "Data not reported":
                              subIndex = 6
                            default:
                              break;
                          }
                          break;
                        case "Race/Ethnicity":
                          classIndex = 4
                          switch (data[i].Subclass) {
                            case "American Indian/Alaska Native":
                              subIndex = 0
                              break;
                            case "Non-Hispanic Black":
                              subIndex = 1
                              break;
                            case "Non-Hispanic White":
                              subIndex = 2
                              break;
                            case "Asian":
                              subIndex = 3
                              break;
                            case "Hawaiian/Pacific Islander":
                              subIndex = 4
                              break;
                            case "Hispanic":
                              subIndex = 5
                              break;
                            case "2 or more races":
                              subIndex = 6
                            case "Other":
                              subIndex = 7
                              break;
                            default:
                              break;
                          }
                          break;
                        default:
                          break;
                      }
                      if (dataValue != "No Data" && yearIndex >= 0 && classIndex >= 0 && subIndex >= 0) {

                        json.features[j].properties.year[yearIndex][classIndex][subIndex] = parseFloat(dataValue)
                      } else {
                        json.features[j].properties.year[yearIndex][classIndex][subIndex] = dataValue
                      }
                    }


                    // Stop looking through the JSON
                  }
                }

                maxRate = 0;
                minRate = 100;
                // 
                svg.selectAll("path").remove()
                svg.selectAll("path")
                  .data(json.features)
                  .enter()
                  .append("path")
                  .attr("d", path)
                  .style("stroke", "#fff")
                  .style("stroke-width", "1")
                  .style("fill", function (d) {
                    // .style("fill", function (d) {
                    // Get data value
                    var value = d.properties.year[y][c][s];

                    if (value > maxRate && value != "DNE") {
                      maxRate = value
                    }

                    if (value < minRate && value != "DNE") {
                      minRate = value
                    }

                    if (value === "DNE") {
                      //If value exists…
                      //If value is und efined…
                      return "rgb(255,201,132)";


                    } else {
                      if (value > 40) {
                        color = d3.interpolateBlues(1)
                      } else {
                        color = d3.interpolateBlues(value / 45)
                      }
                      // var color = d3.scaleLinear().domain([minRate-5, maxRate+5]).range(["rgb(66, 127, 178)", "rgb(0, 0, 94)"])
                      return color//(value);  
                    }
                  })
                //TODO: for the tooltips it may be possible to make it function similar to the json storage
                //embedded arrays thay spit out different text depending on what is selected. 

                svg.selectAll("path")
                  // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
                  // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                  .on("mouseover", function (d) {
                    div.transition()
                      .duration(200)
                      .style("opacity", .9);
                    div.text(d.properties.name + ": " + d.properties.year[y][c][s] + "%")
                      .style("left", (d3.event.pageX) + "px")
                      .style("top", (d3.event.pageY - 28) + "px");
                  })

                  // fade out tooltip on mouse out               
                  .on("mouseout", function (d) {
                    div.transition()
                      .duration(500)
                      .style("opacity", 0);
                  });


                var avg = 0
                var sum = 0
                for (var a = 0; a < json.features.length; a++) {
                  sum = json.features[a].properties.year[y][c][s] + sum
                }
                avg = sum / 51
                d3.select("#avg1")
                  .remove()

                d3.select("#map1")
                  .append("div")
                  .attr("id", "avg1")
                  .attr("ALIGN", "center")
                  .attr("style", "font-size:20px;color:black")
                  .text("Average Obesity PCT: " + avg.toFixed(1) + "%")

                var statenames = Array(51)
                for (var i = 0; i < json.features.length; i++) {
                  statenames[i] = json.features[i].properties.name
                }
                chartjson = Array(51)
                for (var i = 0; i < chartjson.length; i++) {
                  chartjson[i] = []
                }

                for (var j = 0; j < 5; j++) {
                  for (var i = 0; i < json.features.length; i++) {
                    var year = yearsArray[j];
                    var val = (json.features[i].properties.year[j][c][s])
                    console.log(val)
                    if(val==="No Data"){
                      val=0
                    }
                    console.log(val)

                    item = {}
                    item["x"] = year
                    item["y"] = val

                    chartjson[i].push(item)
                  }
                }
                console.log(statenames)

                var chart = new CanvasJS.Chart("chartContainer1", {
                  animationEnabled: false,
                  title: {
                    text: "Select States to View"
                  },
                  axisX: {
                    scaleOverride: true,
                    scaleSteps: 1,
                    minimum: 2011,
                    maximum: 2015,
                    valueFormatString: "####",
                    interval: 1
                  },
                  axisY2: {
                    title: "% Obesity",
                    suffix: "%",
                    minimum: 0,
                  },
                  toolTip: {
                    shared: true
                    
                  },
                  legend: {
                    cursor: "pointer",
                    verticalAlign: "top",
                    horizontalAlign: "center",
                    dockInsidePlotArea: false,
                    itemclick:toogleDataSeries
                  },
                  data: [{
                    type: "line",
                    axisYType: "secondary",
                    name: "Alabama",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[0],
                    visible:false
                    
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Alaska",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[1],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Arizona",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[2],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Arkansas",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[3],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "California",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[4],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Colorado",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[5],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Connecticut",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[6],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Delaware",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[7],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "District of Columbia",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[8],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Florida",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[9],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Georgia",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[10],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Hawaii",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[11],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Idaho",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[12],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Illinois",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[13],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Indiana",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[14],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Iowa",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[15],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Kansas",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[16],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Kentucky",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[17],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Luisiana",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[18],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Maine",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[19],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Maryland",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[20],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Massachusetts",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[21],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Michigan",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[22],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Minnesota",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[23],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Mississippi",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[24],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Missouri",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[25],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Montana",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[26],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Nebraska",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[27],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Nevada",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[28],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "New Hampshire",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[29],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "New Jersey",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[30],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "New Mexico",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[31],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "New York",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[32],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "North Carolina",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[33],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "North Dakota",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[34],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Ohio",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[35],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Oklahoma",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[36],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Oregon",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[37],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Pennsylvania",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[38],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Rhode Island",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[39],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "South Carolina",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[40],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "South Dakota",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[41],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Tennessee",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[42],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Texas",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[43],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Utah",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[44],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Vermont",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[45],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Virginia",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[46],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Washington",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[47],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "West Virginia",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[48],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Wisconsin",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[49],
                    visible:false
                  },
                  {
                    type: "line",
                    axisYType: "secondary",
                    name: "Wyoming",
                    showInLegend:true,
                    markerSize: 0,
                    dataPoints: chartjson[50],
                    visible:false
                  },
                  ]


                })
                chart.render()

                function toogleDataSeries(e) {
                  if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                  } else {
                    e.dataSeries.visible = true;
                  }
                  chart.render();
                }

              })
            })


          }
        </script>
      </div>
      <div class="col-lg-6" id="map2">
        <script>
          var width = 864;
          var height = 450;

          //drop down box values
          var drop1map2Val = 0
          var drop2map2Val = 0
          var drop3map2Val = 0
          // D3 Projection
          var projection = d3.geoAlbersUsa()
            .translate([width / 2, height / 2])    // translate to center of screen
            .scale([900]);          // scale things down so see entire US

          // Define path generator
          var path = d3.geoPath()               // path generator that will convert GeoJSON to SVG paths
            .projection(projection);  // tell path generator to use albersUsa projection
          var svg2 = d3.select("body")
            .append("svg")
            .attr("class", "map2")
            .attr("width", "50%")
            .attr("height", height);




          // Append Div for tooltip to SVG
          var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

          // Load in my states data!

          var statesArray = Array(51)
          var yearsArray = ["2011", "2012", "2013", "2014", "2015"]
          var classArray = ["Age", "Education", "Gender", "Income", "Race"]
          var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
          var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
          var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
          var gender = ["Female", "Male"]
          var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]

          d3.csv("MapData.csv", function (data) {
            //color.domain([0, 1, 2, 3]); // setting the range of the input data

            // this will need to be adjusted to add all of the data from the csv ***
            // Load GeoJSON data and merge with states data
            d3.json("us-states.json", function (json) {
              // Loop through each state data value in the .csv file
              var maxRate = 0;
              var minRate = 100;
              for (var p = 0; p < json.features.length; p++) { //state loop
                statesArray[p] = Array(5)
                for (var t = 0; t < 5; t++) { //loop for each year
                  var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
                  var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
                  var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
                  var gender = ["Female", "Male"]
                  var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
                  statesArray[p][t] = [ages, education, gender, income, races]
                }

                json.features[p].properties.year = statesArray[p]
              }

              for (var k = 0; k < json.features.length; k++) {
              }
              for (var i = 0; i < data.length; i++) {

                // Grab State Name/class/subclass/year
                var dataValue = data[i].Value;
                var dataState = data[i].LocationDesc;
                var dataClass = data[i].Class;
                var dataSub = data[i].Subclass;
                var datayear = data[i].YearStart
                var yearIndex = -1
                var classIndex = -1
                var subIndex = -1

                // Grab data value

                if (dataValue > maxRate && dataValue != "DNE") {
                  maxRate = dataValue
                }

                if (dataValue < minRate && dataValue != "DNE") {
                  minRate = dataValue
                }
                // Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {

                  var jsonState = json.features[j].properties.name;

                  if (dataState == jsonState) {
                    //these switches give the indices where to store the data values within the bigArrays 
                    switch (datayear) {
                      case "2011":
                        yearIndex = 0
                        break;
                      case "2012":
                        yearIndex = 1
                        break;
                      case "2013":
                        yearIndex = 2
                        break;
                      case "2014":
                        yearIndex = 3
                        break;
                      case "2015":
                        yearIndex = 4
                        break;
                      default:
                        break;
                    }

                    switch (dataClass) {
                      case "Age":
                        classIndex = 0
                        switch (dataSub) {
                          case "18 - 24":
                            subIndex = 0
                            break;
                          case "25 - 34":
                            subIndex = 1
                            break;
                          case "35 - 44":
                            subIndex = 2
                            break;
                          case "45 - 54":
                            subIndex = 3
                            break;
                          case "55 - 64":
                            subIndex = 4
                            break;
                          case "65 or older":
                            subIndex = 5
                            break;
                          default:
                            break;

                        }
                        break;
                      case "Education":
                        classIndex = 1
                        switch (data[i].Subclass) {
                          case "College graduate":
                            subIndex = 0
                            break;
                          case "High school graduate":
                            subIndex = 1
                            break;
                          case "Less than high school":
                            subIndex = 2
                            break;
                          case "Some college or technical school":
                            subIndex = 3
                            break;
                          default:
                            break;
                        }
                        break;
                      case "Gender":
                        classIndex = 2
                        switch (data[i].Subclass) {
                          case "Female":
                            subIndex = 0
                            break;
                          case "Male":
                            subIndex = 1
                            break;
                          default:
                            break;
                        }
                        break;
                      case "Income":
                        classIndex = 3
                        switch (data[i].Subclass) {
                          case "Less than $15,000":
                            subIndex = 0
                            break;
                          case "$15,000 - $24,999":
                            subIndex = 1
                            break;
                          case "$25,000 - $34,999":
                            subIndex = 2
                            break;
                          case "$35,000 - $49,999":
                            subIndex = 3
                            break;
                          case "$50,000 - $74,999":
                            subIndex = 4
                            break;
                          case "$75,000 or greater":
                            subIndex = 5
                            break;
                          case "Data not reported":
                            subIndex = 6
                          default:
                            break;
                        }
                        break;
                      case "Race/Ethnicity":
                        classIndex = 4
                        switch (data[i].Subclass) {
                          case "American Indian/Alaska Native":
                            subIndex = 0
                            break;
                          case "Non-Hispanic Black":
                            subIndex = 1
                            break;
                          case "Non-Hispanic White":
                            subIndex = 2
                            break;
                          case "Asian":
                            subIndex = 3
                            break;
                          case "Hawaiian/Pacific Islander":
                            subIndex = 4
                            break;
                          case "Hispanic":
                            subIndex = 5
                            break;
                          case "2 or more races":
                            subIndex = 6
                          case "Other":
                            subIndex = 7
                            break;
                          default:
                            break;
                        }
                        break;
                      default:
                        break;
                    }
                    if (dataValue != "DNE" && yearIndex >= 0 && classIndex >= 0 && subIndex >= 0) {

                      json.features[j].properties.year[yearIndex][classIndex][subIndex] = parseFloat(dataValue)
                    } else {
                      json.features[j].properties.year[yearIndex][classIndex][subIndex] = dataValue
                    }
                  }


                  // Stop looking through the JSON
                }
              }
              drawTotalsMap2()
              // Bind the data to the SVG and create one path per GeoJSON feature
              function drawTotalsMap2() {
                svg2.selectAll("path")
                  .data(json.features)
                  .enter()
                  .append("path")
                  .attr("d", path)
                  .style("stroke", "#fff")
                  .style("stroke-width", "1")
                  .style("fill", function (d) {

                    // Get data value
                    var value = d.properties.year[0][0][0];

                    if (value === "DNE") {
                      //If value exists…
                      //If value is und efined…
                      return "rgb(255,201,132)";


                    } else {
                      //color = d3.interpolateBlues(value / (maxRate / 100))
                      if (value > 40) {
                        color = d3.interpolateBlues(1)
                      } else {
                        color = d3.interpolateBlues(value / 45)
                      }
                      return color//(value);
                    }
                  })
                svg2.selectAll("path")
                  // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
                  // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                  .on("mouseover", function (d) {
                    div.transition()
                      .duration(200)
                      .style("opacity", .9);
                    div.text(d.properties.name + ": " + d.properties.year[0][0][0] + "%")
                      .style("left", (d3.event.pageX) + "px")
                      .style("top", (d3.event.pageY - 28) + "px");
                  })

                  // fade out tooltip on mouse out               
                  .on("mouseout", function (d) {
                    div.transition()
                      .duration(500)
                      .style("opacity", 0);
                  });

                var avg = 0
                var sum = 0
                for (var a = 0; a < json.features.length; a++) {
                  sum = json.features[a].properties.year[drop1map1Val][drop2map1Val][drop3map1Val] + sum
                }
                avg = sum / 51
                d3.select("#avg2")
                  .remove()

                d3.select("#map2")
                  .append("div")
                  .attr("id", "avg1")
                  .attr("ALIGN", "center")
                  .attr("style", "font-size:20px;color:black")
                  .text("Average Obesity PCT: " + avg.toFixed(1) + "%")

              }
            })
          })
          var dropdowns = d3.select("#map2")
            .append("div")
            .attr("class", "dropdown")
            .attr("id", "drop1map2");

          var button = d3.select("#drop1map2")
            .append("button")
            .attr("class", "btn btn-primary dropdown-toggle")
            .attr("type", "button")
            .attr("data-toggle", "dropdown")
            .text("Select Year")
            .attr("id", "drop1buttonmap2");

          var span = d3.select("#drop1buttonmap2")
            .append("span")
            .attr("class", "caret")

          var menu = d3.select("#drop1map2")
            .append("ul")
            .attr("class", "dropdown-menu")
            .attr("id", "drop1listmap2");

          for (var k = 0; k < yearsArray.length; k++) {
            var dropSubs = d3.select("#drop1listmap2")
              .append("li")
              .attr("id", "drop1limap2")

            var addSubs = d3.select("#drop1limap2")
              .append("a")
              .text(yearsArray[k])
              .attr("onclick", "setDrop1map2(" + k + ");changedrop1map2(" + k + ")")
          }

          function changedrop1map2(j) {
            $("#drop1buttonmap2")
              .remove()

            var button = d3.select("#drop1map2")
              .append("button")
              .attr("class", "btn btn-primary dropdown-toggle")
              .attr("type", "button")
              .attr("data-toggle", "dropdown")
              .text(yearsArray[j])
              .attr("id", "drop1buttonmap2");
            var span = d3.select("#drop1buttonmap2")
              .append("span")
              .attr("class", "caret")
          };

          function setDrop1map2(data) {
            drop1map2Val = data
            updateMap2()

          }
          //making the class dropdown boxes

          var dropdowns = d3.select("#map2")
            .append("div")
            .attr("class", "dropdown")
            .attr("id", "drop2map2");

          var button = d3.select("#drop2map2")
            .append("button")
            .attr("class", "btn btn-primary dropdown-toggle")
            .attr("type", "button")
            .attr("data-toggle", "dropdown")
            .text("Select Class")
            .attr("id", "drop2buttonmap2");

          var span = d3.select("#drop2buttonmap2")
            .append("span")
            .attr("class", "caret")

          var menu = d3.select("#drop2map2")
            .append("ul")
            .attr("class", "dropdown-menu")
            .attr("id", "drop2listmap2");

          for (var j = 0; j < classArray.length; j++) {
            var dropSubs = d3.select("#drop2listmap2")
              .append("li")
              .attr("id", "drop2limap2")

            var addSubs = d3.select("#drop2limap2")
              .append("a")
              .text(classArray[j])
              .attr("onclick", "makeDrop3map2(" + j + ");setDrop2map2(" + j + ");changedrop2map2(" + j + ")")


          }

          function changedrop2map2(j) {
            $("#drop2buttonmap2")
              .remove()

            var button = d3.select("#drop2map2")
              .append("button")
              .attr("class", "btn btn-primary dropdown-toggle")
              .attr("type", "button")
              .attr("data-toggle", "dropdown")
              .text(classArray[j])
              .attr("id", "drop2buttonmap2");
            var span = d3.select("#drop2buttonmap2")
              .append("span")
              .attr("class", "caret")
          };

          function setDrop2map2(data) {
            drop2map2Val = data
          }


          var dropdowns = d3.select("#map2")
            .append("div")
            .attr("class", "dropdown")
            .attr("id", "drop3map2");

          var button = d3.select("#drop3map2")
            .append("button")
            .attr("class", "btn btn-primary dropdown-toggle")
            .attr("type", "button")
            .attr("data-toggle", "dropdown")
            .text("Select Subclass")
            .attr("id", "drop3buttonmap2");

          var span = d3.select("#drop3buttonmap2")
            .append("span")
            .attr("class", "caret")

          var menu = d3.select("#drop3map2")
            .append("ul")
            .attr("class", "dropdown-menu")
            .attr("id", "drop3listmap2");

          function makeDrop3map2(subclassVal) {
            d3.selectAll("#drop3limap2").remove()
            var dropSubs = d3.select("#drop3listmap2")
              .append("li")
              .attr("id", "drop3limap2")

            for (var k = 0; k < subArray[subclassVal].length; k++) {

              var addSubs = d3.select("#drop3limap2")
                .append("a")
                .text(subArray[subclassVal][k])
                .attr("onclick", "setDrop3map2(" + k + ");changedrop3map2(" + k + "," + subclassVal + ")")

            }
            //making the third subclass array which is variable based on a variable



          }

          function changedrop3map2(j, subClassVal) {
            $("#drop3buttonmap2")
              .remove()

            var button = d3.select("#drop3map2")
              .append("button")
              .attr("class", "btn btn-primary dropdown-toggle")
              .attr("type", "button")
              .attr("data-toggle", "dropdown")
              .text(subArray[subClassVal][j])
              .attr("id", "drop3buttonmap2");
            var span = d3.select("#drop3buttonmap2")
              .append("span")
              .attr("class", "caret")
          };

          function setDrop3map2(val) {
            drop3map2Val = val;
            updateMap2();
          }

          function updateMap2() {
            makemap2(drop1map2Val, drop2map2Val, drop3map2Val);

          }


          function makemap2(y, c, s) {
            var statesArray = Array(51)
            var yearsArray = ["2011", "2012", "2013", "2014", "2015"]
            var classArray = ["Age", "Education", "Gender", "Income", "Race"]
            var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
            var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
            var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
            var gender = ["Female", "Male"]
            var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
            d3.csv("MapData.csv", function (data) {
              //color.domain([0, 1, 2, 3]); // setting the range of the input data

              // this will need to be adjusted to add all of the data from the csv ***
              // Load GeoJSON data and merge with states data
              d3.json("us-states.json", function (json) {
                // Loop through each state data value in the .csv file
                var maxRate = 0;
                var minRate = 100;
                for (var p = 0; p < json.features.length; p++) { //state loop
                  statesArray[p] = Array(5)
                  for (var t = 0; t < 5; t++) { //loop for each year
                    var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater", "Data not reported"]
                    var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 or older"]
                    var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "2 or More Races", "Other"]
                    var gender = ["Female", "Male"]
                    var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
                    statesArray[p][t] = [ages, education, gender, income, races]
                  }

                  json.features[p].properties.year = statesArray[p]
                }

                for (var k = 0; k < json.features.length; k++) {
                }
                for (var i = 0; i < data.length; i++) {

                  // Grab State Name/class/subclass/year
                  var dataValue = data[i].Value;
                  var dataState = data[i].LocationDesc;
                  var dataClass = data[i].Class;
                  var dataSub = data[i].Subclass;
                  var datayear = data[i].YearStart
                  var yearIndex = -1
                  var classIndex = -1
                  var subIndex = -1

                  // Grab data value

                  if (dataValue > maxRate && dataValue != "DNE") {
                    maxRate = dataValue
                  }

                  if (dataValue < minRate && dataValue != "DNE") {
                    minRate = dataValue
                  }
                  // Find the corresponding state inside the GeoJSON
                  for (var j = 0; j < json.features.length; j++) {

                    var jsonState = json.features[j].properties.name;

                    if (dataState == jsonState) {
                      //these switches give the indices where to store the data values within the bigArrays 
                      switch (datayear) {
                        case "2011":
                          yearIndex = 0
                          break;
                        case "2012":
                          yearIndex = 1
                          break;
                        case "2013":
                          yearIndex = 2
                          break;
                        case "2014":
                          yearIndex = 3
                          break;
                        case "2015":
                          yearIndex = 4
                          break;
                        default:
                          break;
                      }

                      switch (dataClass) {
                        case "Age":
                          classIndex = 0
                          switch (dataSub) {
                            case "18 - 24":
                              subIndex = 0
                              break;
                            case "25 - 34":
                              subIndex = 1
                              break;
                            case "35 - 44":
                              subIndex = 2
                              break;
                            case "45 - 54":
                              subIndex = 3
                              break;
                            case "55 - 64":
                              subIndex = 4
                              break;
                            case "65 or older":
                              subIndex = 5
                              break;
                            default:
                              break;

                          }
                          break;
                        case "Education":
                          classIndex = 1
                          switch (data[i].Subclass) {
                            case "College graduate":
                              subIndex = 0
                              break;
                            case "High school graduate":
                              subIndex = 1
                              break;
                            case "Less than high school":
                              subIndex = 2
                              break;
                            case "Some college or technical school":
                              subIndex = 3
                              break;
                            default:
                              break;
                          }
                          break;
                        case "Gender":
                          classIndex = 2
                          switch (data[i].Subclass) {
                            case "Female":
                              subIndex = 0
                              break;
                            case "Male":
                              subIndex = 1
                              break;
                            default:
                              break;
                          }
                          break;
                        case "Income":
                          classIndex = 3
                          switch (data[i].Subclass) {
                            case "Less than $15,000":
                              subIndex = 0
                              break;
                            case "$15,000 - $24,999":
                              subIndex = 1
                              break;
                            case "$25,000 - $34,999":
                              subIndex = 2
                              break;
                            case "$35,000 - $49,999":
                              subIndex = 3
                              break;
                            case "$50,000 - $74,999":
                              subIndex = 4
                              break;
                            case "$75,000 or greater":
                              subIndex = 5
                              break;
                            case "Data not reported":
                              subIndex = 6
                            default:
                              break;
                          }
                          break;
                        case "Race/Ethnicity":
                          classIndex = 4
                          switch (data[i].Subclass) {
                            case "American Indian/Alaska Native":
                              subIndex = 0
                              break;
                            case "Non-Hispanic Black":
                              subIndex = 1
                              break;
                            case "Non-Hispanic White":
                              subIndex = 2
                              break;
                            case "Asian":
                              subIndex = 3
                              break;
                            case "Hawaiian/Pacific Islander":
                              subIndex = 4
                              break;
                            case "Hispanic":
                              subIndex = 5
                              break;
                            case "2 or more races":
                              subIndex = 6
                            case "Other":
                              subIndex = 7
                              break;
                            default:
                              break;
                          }
                          break;
                        default:
                          break;
                      }
                      if (dataValue != "DNE" && yearIndex >= 0 && classIndex >= 0 && subIndex >= 0) {

                        json.features[j].properties.year[yearIndex][classIndex][subIndex] = parseFloat(dataValue)
                      } else {
                        json.features[j].properties.year[yearIndex][classIndex][subIndex] = dataValue
                      }
                    }


                    // Stop looking through the JSON
                  }
                }

                maxRate = 0;
                minRate = 100;
                // 
                svg2.selectAll("path").remove()
                svg2.selectAll("path")
                  .data(json.features)
                  .enter()
                  .append("path")
                  .attr("d", path)
                  .style("stroke", "#fff")
                  .style("stroke-width", "1")
                  .style("fill", function (d) {
                    // .style("fill", function (d) {
                    // Get data value
                    var value = d.properties.year[y][c][s];

                    if (value > maxRate && value != "DNE") {
                      maxRate = value
                    }

                    if (value < minRate && value != "DNE") {
                      minRate = value
                    }

                    if (value === "DNE") {
                      //If value exists…
                      //If value is und efined…
                      return "rgb(255,201,132)";


                    } else {

                      if (value > 40) {
                        color = d3.interpolateBlues(1)
                      } else {
                        color = d3.interpolateBlues(value / 45)
                      }
                      // var color = d3.scaleLinear().domain([minRate-5, maxRate+5]).range(["rgb(66, 127, 178)", "rgb(0, 0, 94)"])
                      return color//(value);  
                    }
                  })
                svg2.selectAll("path")
                  // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
                  // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                  .on("mouseover", function (d) {
                    div.transition()
                      .duration(200)
                      .style("opacity", .9);
                    div.text(d.properties.name + ": " + d.properties.year[y][c][s] + "%")
                      .style("left", (d3.event.pageX) + "px")
                      .style("top", (d3.event.pageY - 28) + "px");
                  })

                  // fade out tooltip on mouse out               
                  .on("mouseout", function (d) {
                    div.transition()
                      .duration(500)
                      .style("opacity", 0);
                  });
                var avg = 0
                var sum = 0
                for (var a = 0; a < json.features.length; a++) {
                  sum = json.features[a].properties.year[y][c][s] + sum
                }
                avg = sum / 51
                d3.select("#avg2")
                  .remove()

                d3.select("#map2")
                  .append("div")
                  .attr("id", "avg1")
                  .attr("ALIGN", "center")
                  .attr("style", "font-size:20px;color:black")
                  .text("Average Obesity PCT: " + avg.toFixed(1) + "%")

              })
            })



          }
          // var buildmap2 = d3.select("#map2")
          //   .append("button")
          //   .attr("class", "button")
          //   .attr("onclick", "makemap2(" + drop1map2Val + "," + drop2map2Val + "," + drop3map2Val + ")")
          //   .text("Click to build map")


          // d3.csv("MapData.csv", function (data) {
          //   //color.domain([0, 1, 2, 3]); // setting the range of the input data


          //   // this will need to be adjusted to add all of the data from the csv ***
          //   // Load GeoJSON data and merge with states data
          //   d3.json("us-states.json", function (json) {

          //     // Loop through each state data value in the .csv file
          //     var maxRate = 0;
          //     var minRate = 100;
          //     for (var i = 0; i < data.length; i++) {

          //       // Grab State Name
          //       var dataState = data[i].LocationDesc;

          //       // Grab data value
          //       var dataValue = data[i].twoeleven;
          //       if (dataValue > maxRate && dataValue != "DNE") {
          //         maxRate = dataValue
          //       }

          //       if (dataValue < minRate && dataValue != "DNE") {
          //         minRate = dataValue
          //       }
          //       // Find the corresponding state inside the GeoJSON
          //       for (var j = 0; j < json.features.length; j++) {
          //         var jsonState = json.features[j].properties.name;

          //         if (dataState == jsonState) {

          //           // Copy the data value into the JSON
          //           json.features[j].properties.year = dataValue;


          //           // Stop looking through the JSON
          //           break;
          //         }
          //       }
          //     }
          //     // Bind the data to the SVG and create one path per GeoJSON feature
          //     svg2.selectAll("path")
          //       .select(".map2")
          //       .data(json.features)
          //       .enter()
          //       .append("path")
          //       .attr("d", path)
          //       .style("stroke", "#fff")
          //       .style("stroke-width", "1")
          //       .style("fill", function (d) {

          //         // Get data value
          //         var value = d.properties.year;

          //         if (value === "DNE") {
          //           //If value exists…
          //           //If value is undefined…
          //           return "black";


          //         } else {
          //           //color = d3.interpolateBlues(value / (maxRate / 100))
          //           var color = d3.scaleLinear().domain([minRate - 5, maxRate]).range(["white", "steelblue"])
          //           return color(value);
          //         }
          //       })
          //     svg2.selectAll("path")
          //       // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
          //       // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
          //       .on("mouseover", function (d) {
          //         div.transition()
          //           .duration(200)
          //           .style("opacity", .9);
          //         div.text(d.properties.year + "% of the population in " + d.properties.name + " is obese.")
          //           .style("left", (d3.event.pageX) + "px")
          //           .style("top", (d3.event.pageY - 28) + "px");
          //       })

          //       // fade out tooltip on mouse out               
          //       .on("mouseout", function (d) {
          //         div.transition()
          //           .duration(500)
          //           .style("opacity", 0);
          //       });


          //   });
          // });



          // var yearsArray = ["2011", "2012", "2013", "2014", "2015"]

          // //making the years dropdown box
          // var dropdowns = d3.select("#map2")
          //   .append("div")
          //   .attr("class", "dropdown")
          //   .attr("id", "drop1map2");

          // var button = d3.select("#drop1map2")
          //   .append("button")
          //   .attr("class", "btn btn-primary dropdown-toggle")
          //   .attr("type", "button")
          //   .attr("data-toggle", "dropdown")
          //   .text("Select Year")
          //   .attr("id", "drop1buttonmap2");

          // var span = d3.select("#drop1buttonmap2")
          //   .append("span")
          //   .attr("class", "caret")

          // var menu = d3.select("#drop1map2")
          //   .append("ul")
          //   .attr("class", "dropdown-menu")
          //   .attr("id", "drop1listmap2");

          // for (var k = 0; k < yearsArray.length; k++) {
          //   var dropSubs = d3.select("#drop1listmap2")
          //     .append("li")
          //     .attr("id", "drop1limap2")

          //   var addSubs = d3.select("#drop1limap2")
          //     .append("a")
          //     .text(yearsArray[k])
          //     .attr("onclick", "setDrop1Map2(" + k + ")")
          // }

          // function setDrop1Map2(data) {
          //   drop1Map2Val = data
          // }
          // //making the class dropdown boxes
          // var classArray = ["Age", "Education", "Gender", "Income", "Race"]
          // var dropdowns = d3.select("#map2")
          //   .append("div")
          //   .attr("class", "dropdown")
          //   .attr("id", "drop2map2");

          // var button = d3.select("#drop2map2")
          //   .append("button")
          //   .attr("class", "btn btn-primary dropdown-toggle")
          //   .attr("type", "button")
          //   .attr("data-toggle", "dropdown")
          //   .text("Select Class")
          //   .attr("id", "drop2buttonmap2");

          // var span = d3.select("#drop2buttonmap2")
          //   .append("span")
          //   .attr("class", "caret")

          // var menu = d3.select("#drop2map2")
          //   .append("ul")
          //   .attr("class", "dropdown-menu")
          //   .attr("id", "drop2listmap2");

          // for (var j = 0; j < classArray.length; j++) {
          //   var dropSubs = d3.select("#drop2listmap2")
          //     .append("li")
          //     .attr("id", "drop2limap2")

          //   var addSubs = d3.select("#drop2limap2")
          //     .append("a")
          //     .text(classArray[j])
          //     .attr("onclick", "makeDrop3Map2(" + j + ");setDrop2Map2(" + j + ")")


          // }

          // function setDrop2Map2(data) {
          //   drop2Map2Val = data
          // }
          // var income = ["Less than $15,000", "$15,000 - $24,999", "$25,000 - $34,999", "$35,000 - $49,999", "$50,000 - $74,999", "$75,000 or greater"]
          // var ages = ["18 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65-100"]
          // var races = ["American Indian/Alaska Native", "Non-Hispanic Black", "Non-Hispanic White", "Asian", "Hawaiian/Pacific Islander", "Hispanic", "Data not reported", "2 or More Races", "Other"]
          // var gender = ["Female", "Male"]
          // var education = ["College Graduate", "High School Graduate", "Less Than High School", "Some College or Technical School"]
          // var subArray = [ages, education, gender, income, races]

          // var dropdowns = d3.select("#map2")
          //   .append("div")
          //   .attr("class", "dropdown")
          //   .attr("id", "drop3map2");

          // var button = d3.select("#drop3map2")
          //   .append("button")
          //   .attr("class", "btn btn-primary dropdown-toggle")
          //   .attr("type", "button")
          //   .attr("data-toggle", "dropdown")
          //   .text("Select Subclass")
          //   .attr("id", "drop3buttonmap2");

          // var span = d3.select("#drop3buttonmap2")
          //   .append("span")
          //   .attr("class", "caret")

          // var menu = d3.select("#drop3map2")
          //   .append("ul")
          //   .attr("class", "dropdown-menu")
          //   .attr("id", "drop3listmap2");

          // function makeDrop3Map2(subclassVal) {
          //   d3.selectAll("#drop3limap2").remove()

          //   var dropSubs = d3.select("#drop3listmap2")
          //     .append("li")
          //     .attr("id", "drop3limap2")

          //   for (var k = 0; k < subArray[subclassVal].length; k++) {


          //     var addSubs = d3.select("#drop3limap2")
          //       .append("a")
          //       .text(subArray[subclassVal][k])
          //       .attr("onclick", "setDrop3Map2(" + k + ");makeMap2(" + drop1Map2Val + "," + drop2Map2Val + "," + drop3Map2Val + ")");

          //   }
          //   //making the third subclass array which is variable based on a variable
          // }

          // function setDrop3Map2(data) {
          //   drop3Map2Val = data
          // }


          // //                  2011     2012     2013     2014   2015
          // var totalArray = [subArray, subArray, subArray, subArray, subArray]
          // //function to make a map depending on the values given by the drop boxes
          // //year:2011 = i1=0
          // //class = age = i2=0
          // //subclass
          // function makeMap2(i1, i2, i3) {

          //   var masterIndex = i1 * 4 + i2 * 5 + i3
          //   //2011-income-0to15k = index 0 
          //   //2011-income-15kto25k = index 1
          //   //2012-age-25to34 = index 10
          //   d3.csv("FINALDATAProperFormat.csv", function (data) {


          //     // this will need to be adjusted to add all of the data from the csv ***
          //     // Load GeoJSON data and merge with states data
          //     d3.json("us-states.json", function (json) {

          //       // Loop through each state data value in the .csv file
          //       var maxRate = 0;
          //       var minRate = 100;
          //       for (var i = 0; i < data.length; i++) {

          //         // Grab State Name
          //         var dataState = data[i].LocationDesc;

          //         // Grab data value
          //         var dataValue = data[i].twoeleven;
          //         if (dataValue > maxRate && dataValue != "DNE") {
          //           maxRate = dataValue
          //         }

          //         if (dataValue < minRate && dataValue != "DNE") {
          //           minRate = dataValue
          //         }
          //         // Find the corresponding state inside the GeoJSON
          //         for (var j = 0; j < json.features.length; j++) {
          //           var jsonState = json.features[j].properties.name;

          //           if (dataState == jsonState) {

          //             // Copy the data value into the JSON
          //             json.features[j].properties.year = dataValue;


          //             // Stop looking through the JSON
          //             break;
          //           }
          //         }
          //       }
          //       // Bind the data to the SVG and create one path per GeoJSON feature
          //       svg2.selectAll("path")
          //         .data(json.features)
          //         .enter()
          //         .append("path")
          //         .attr("d", path)
          //         .style("stroke", "#fff")
          //         .style("stroke-width", "1")
          //         .style("fill", function (d) {

          //           // Get data value
          //           var value = d.properties.year;

          //           if (value === "DNE") {
          //             //If value exists…
          //             //If value is undefined…
          //             return "black";


          //           } else {
          //             //color = d3.interpolateBlues(value / (maxRate / 100))
          //             var color = d3.scaleLinear().domain([minRate - 5, maxRate]).range(["white", "steelblue"])
          //             return color(value);
          //           }
          //         })
          //       svg2.selectAll("path")
          //         // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
          //         // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
          //         .on("mouseover", function (d) {
          //           div.transition()
          //             .duration(200)
          //             .style("opacity", .9);
          //           div.text(d.properties.year + "% of the population in " + d.properties.name + " is obese.")
          //             .style("left", (d3.event.pageX) + "px")
          //             .style("top", (d3.event.pageY - 28) + "px");
          //         })

          //         // fade out tooltip on mouse out               
          //         .on("mouseout", function (d) {
          //           div.transition()
          //             .duration(500)
          //             .style("opacity", 0);
          //         });


          //     });
          //   });
          // }



        </script>
      </div>
    </div>
  </div>
  <div id="chartContainer1" style="height:500px;width:50%"></div>
  <div id="chartContainer2" style="height:500px;width:50%"></div>


</body>

</html>